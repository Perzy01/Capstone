TYPE=TRIGGERS
triggers='CREATE DEFINER=`root`@`localhost` TRIGGER `attendance_notification` AFTER INSERT ON `attendance` FOR EACH ROW BEGIN\n  DECLARE emp_name VARCHAR(100);\n  \n  \n  SELECT CONCAT(`First Name`, \' \', `Last Name`) INTO emp_name \n  FROM employee \n  WHERE EmployeeID = NEW.EMPLOYEEID;\n  \n  \n  IF emp_name IS NULL THEN\n    SET emp_name = CONCAT(\'Employee ID \', NEW.EMPLOYEEID);\n  END IF;\n  \n  \n  IF NEW.MODIFIED_BY IS NULL THEN\n    \n    INSERT INTO notifications (message, type, reference_id)\n    VALUES (CONCAT(emp_name, \' marked attendance at \', NEW.TIMEIN), \'attendance\', NEW.ID);\n  ELSE\n    \n    INSERT INTO notifications (message, type, reference_id)\n    VALUES (CONCAT(\'Admin \', NEW.MODIFIED_BY, \' manually recorded attendance for \', emp_name), \'attendance\', NEW.ID);\n  END IF;\nEND' 'CREATE DEFINER=`root`@`localhost` TRIGGER `manual_attendance_modification` AFTER UPDATE ON `attendance` FOR EACH ROW BEGIN\n  DECLARE emp_name VARCHAR(100);\n  \n  \n  IF NEW.MODIFIED_BY IS NOT NULL AND (OLD.MODIFIED_BY <> NEW.MODIFIED_BY OR OLD.MODIFIED_BY IS NULL) THEN\n    \n    SELECT CONCAT(`First Name`, \' \', `Last Name`) INTO emp_name \n    FROM employee \n    WHERE EmployeeID = NEW.EMPLOYEEID;\n    \n    \n    IF emp_name IS NULL THEN\n      SET emp_name = CONCAT(\'Employee ID \', NEW.EMPLOYEEID);\n    END IF;\n    \n    \n    SET @changes = \'\';\n    \n    IF OLD.TIMEIN <> NEW.TIMEIN THEN\n      SET @changes = CONCAT(@changes, \'Time In, \');\n    END IF;\n    \n    IF OLD.TIMEOUT <> NEW.TIMEOUT OR (OLD.TIMEOUT IS NULL AND NEW.TIMEOUT IS NOT NULL) THEN\n      SET @changes = CONCAT(@changes, \'Time Out, \');\n    END IF;\n    \n    IF OLD.STATUS <> NEW.STATUS OR (OLD.STATUS IS NULL AND NEW.STATUS IS NOT NULL) THEN\n      SET @changes = CONCAT(@changes, \'Status, \');\n    END IF;\n    \n    \n    IF LENGTH(@changes) > 0 THEN\n      SET @changes = CONCAT(\'Changed: \', LEFT(@changes, LENGTH(@changes) - 2));\n    ELSE\n      SET @changes = \'Modified attendance record\';\n    END IF;\n    \n    \n    INSERT INTO notifications (message, type, reference_id)\n    VALUES (CONCAT(\'Admin \', NEW.MODIFIED_BY, \' modified attendance record for \', emp_name, \' (\', @changes, \')\'), \'attendance\', NEW.ID);\n  END IF;\nEND'
sql_modes=524288 524288
definers='root@localhost' 'root@localhost'
client_cs_names='utf8mb4' 'utf8mb4'
connection_cl_names='utf8mb4_general_ci' 'utf8mb4_general_ci'
db_cl_names='latin1_swedish_ci' 'latin1_swedish_ci'
created=174729880829 174729880832
